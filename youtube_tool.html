<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 嵌入生成器 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue-icon.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-vue@latest/dist/arco.css">
    <style>
        body { background-color: #f2f3f5; }
        .preview-container {
            background: #000;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }
        .preview-container iframe, .preview-container .placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .preview-container .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="app">
        <a-layout style="min-height: 100vh;">
            <a-page-header
                style="background: #fff; border-bottom: 1px solid #e5e6eb;"
                title="YouTube 嵌入代码生成器"
                subtitle="快速生成标准 iframe 嵌入代码"
                @back="goBack"
            ></a-page-header>
            <a-layout-content style="padding: 24px;">
                <div style="max-width: 1200px; margin: 0 auto;">
                    <a-row :gutter="[24, 24]">
                        <a-col :xs="24" :md="10">
                            <a-card title="配置参数" :bordered="false">
                                <a-form
                                    :model="form"
                                    layout="vertical"
                                >
                                    <a-form-item label="YouTube 视频 ID 或 URL" field="videoId">
                                        <a-input v-model="form.videoId" placeholder="例如: dQw4w9WgXcQ 或完整链接" />
                                    </a-form-item>
                                    <a-row :gutter="16">
                                        <a-col :span="12">
                                            <a-form-item label="宽度 (px)" field="width">
                                                <a-input-number v-model="form.width" :min="100" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="12">
                                            <a-form-item label="高度 (px)" field="height">
                                                <a-input-number v-model="form.height" :min="100" />
                                            </a-form-item>
                                        </a-col>
                                    </a-row>
                                    <a-row :gutter="16">
                                        <a-col :span="8">
                                            <a-form-item label="自动播放" field="autoplay">
                                                <a-switch v-model="form.autoplay" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="8">
                                            <a-form-item label="静音" field="mute">
                                                <a-switch v-model="form.mute" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="8">
                                            <a-form-item label="显示控件" field="controls">
                                                <a-switch v-model="form.controls" />
                                            </a-form-item>
                                        </a-col>
                                    </a-row>
                                </a-form>
                            </a-card>

                            <a-card title="生成代码" :bordered="false" style="margin-top: 24px;">
                                <a-textarea 
                                    v-model="code" 
                                    :auto-size="{ minRows: 6, maxRows: 10 }"
                                    placeholder="生成的 HTML 代码将显示在这里..."
                                />
                                <a-button type="primary" long style="margin-top: 16px;" @click="handleCopy" :disabled="!code">
                                    <template #icon><icon-copy /></template> 一键复制代码
                                </a-button>
                            </a-card>
                        </a-col>
                        <a-col :xs="24" :md="14">
                            <a-card title="实时预览" :bordered="false" style="height: 100%;">
                                <div class="preview-container">
                                    <iframe 
                                        v-if="previewSrc"
                                        :src="previewSrc" 
                                        title="YouTube video player" 
                                        frameBorder="0" 
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                        referrerPolicy="strict-origin-when-cross-origin" 
                                        allowFullScreen
                                    ></iframe>
                                    <div v-else class="placeholder">
                                        <icon-video-camera style="font-size: 48px; margin-bottom: 16px;" />
                                        <p>请输入视频 ID 查看预览</p>
                                    </div>
                                </div>
                                <div style="margin-top: 16px;">
                                    <a-typography-text type="secondary">
                                        注意：部分视频可能限制了嵌入播放。如果预览无法加载，请检查视频权限。
                                    </a-typography-text>
                                </div>
                            </a-card>
                        </a-col>
                    </a-row>
                </div>
            </a-layout-content>
        </a-layout>
    </div>

    <script>
        const { createApp } = Vue;
        const { Message } = ArcoVue;

        const App = {
            data() {
                return {
                    form: {
                        videoId: '',
                        width: 560,
                        height: 315,
                        autoplay: false,
                        mute: false,
                        controls: true
                    },
                    code: '',
                    previewSrc: ''
                };
            },
            watch: {
                form: {
                    handler(newVal) {
                        this.generateCode(newVal);
                    },
                    deep: true
                }
            },
            methods: {
                goBack() {
                    window.location.href = 'index.html';
                },
                extractVideoId(input) {
                    if (!input) return '';
                    const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                    const match = input.match(regExp);
                    return (match && match[2].length === 11) ? match[2] : input;
                },
                generateCode(values) {
                    const id = this.extractVideoId(values.videoId);
                    if (!id) {
                        this.code = '';
                        this.previewSrc = '';
                        return;
                    }

                    const params = [];
                    if (values.autoplay) params.push('autoplay=1');
                    if (values.mute) params.push('mute=1');
                    if (!values.controls) params.push('controls=0');

                    const query = params.length > 0 ? '?' + params.join('&') : '';
                    const src = `https://www.youtube.com/embed/${id}${query}`;
                    
                    this.previewSrc = src;

                    const iframeHtml = `<iframe width="${values.width}" height="${values.height}" src="${src}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
                    
                    this.code = iframeHtml;
                },
                handleCopy() {
                    if (!this.code) return;
                    navigator.clipboard.writeText(this.code).then(() => {
                        Message.success('代码已复制到剪贴板');
                    }).catch(() => {
                        Message.error('复制失败');
                    });
                }
            }
        };

        const app = createApp(App);
        app.use(ArcoVue);
        app.use(ArcoVueIcon);
        app.mount('#app');
    </script>
</body>
</html>
