<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube 嵌入生成器 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-react@latest/dist/css/arco.min.css">
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco-icon.min.js"></script>
    <style>
        body { background-color: #f2f3f5; }
        .preview-container {
            background: #000;
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }
        .preview-container iframe, .preview-container .placeholder {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .preview-container .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            color: #fff;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { Layout, Card, Form, Input, InputNumber, Switch, Button, Grid, Typography, Message, Divider, PageHeader } = arco;
        const { Header, Content } = Layout;
        const { Title, Text } = Typography;
        const { Row, Col } = Grid;
        const { IconCopy, IconVideoCamera } = arcoicon;

        function App() {
            const [form] = Form.useForm();
            const [code, setCode] = React.useState('');
            const [previewSrc, setPreviewSrc] = React.useState('');
            const [config, setConfig] = React.useState({
                videoId: '',
                width: 560,
                height: 315,
                autoplay: false,
                mute: false,
                controls: true
            });

            const extractVideoId = (input) => {
                if (!input) return '';
                const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
                const match = input.match(regExp);
                return (match && match[2].length === 11) ? match[2] : input;
            };

            const generateCode = (values) => {
                const id = extractVideoId(values.videoId);
                if (!id) {
                    setCode('');
                    setPreviewSrc('');
                    return;
                }

                const params = [];
                if (values.autoplay) params.push('autoplay=1');
                if (values.mute) params.push('mute=1');
                if (!values.controls) params.push('controls=0');

                const query = params.length > 0 ? '?' + params.join('&') : '';
                const src = `https://www.youtube.com/embed/${id}${query}`;
                
                setPreviewSrc(src);

                const iframeHtml = `<iframe width="${values.width}" height="${values.height}" src="${src}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>`;
                
                setCode(iframeHtml);
            };

            const onValuesChange = (changeValue, values) => {
                setConfig(values);
                generateCode(values);
            };

            const handleCopy = () => {
                if (!code) return;
                navigator.clipboard.writeText(code).then(() => {
                    Message.success('代码已复制到剪贴板');
                }).catch(() => {
                    Message.error('复制失败');
                });
            };

            return (
                <Layout style={{ minHeight: '100vh' }}>
                    <PageHeader
                        style={{ background: '#fff', borderBottom: '1px solid #e5e6eb' }}
                        title="YouTube 嵌入代码生成器"
                        subTitle="快速生成标准 iframe 嵌入代码"
                        backIcon
                        onBack={() => window.location.href = 'index.html'}
                    />
                    <Content style={{ padding: '24px' }}>
                        <div style={{ maxWidth: 1200, margin: '0 auto' }}>
                            <Row gutter={[24, 24]}>
                                <Col xs={24} md={10}>
                                    <Card title="配置参数" bordered={false}>
                                        <Form
                                            form={form}
                                            layout="vertical"
                                            initialValues={config}
                                            onValuesChange={onValuesChange}
                                        >
                                            <Form.Item label="YouTube 视频 ID 或 URL" field="videoId">
                                                <Input placeholder="例如: dQw4w9WgXcQ 或完整链接" />
                                            </Form.Item>
                                            <Row gutter={16}>
                                                <Col span={12}>
                                                    <Form.Item label="宽度 (px)" field="width">
                                                        <InputNumber min={100} />
                                                    </Form.Item>
                                                </Col>
                                                <Col span={12}>
                                                    <Form.Item label="高度 (px)" field="height">
                                                        <InputNumber min={100} />
                                                    </Form.Item>
                                                </Col>
                                            </Row>
                                            <Row gutter={16}>
                                                <Col span={8}>
                                                    <Form.Item label="自动播放" field="autoplay" triggerPropName="checked">
                                                        <Switch />
                                                    </Form.Item>
                                                </Col>
                                                <Col span={8}>
                                                    <Form.Item label="静音" field="mute" triggerPropName="checked">
                                                        <Switch />
                                                    </Form.Item>
                                                </Col>
                                                <Col span={8}>
                                                    <Form.Item label="显示控件" field="controls" triggerPropName="checked">
                                                        <Switch />
                                                    </Form.Item>
                                                </Col>
                                            </Row>
                                        </Form>
                                    </Card>

                                    <Card title="生成代码" bordered={false} style={{ marginTop: 24 }}>
                                        <Input.TextArea 
                                            value={code} 
                                            autoSize={{ minRows: 6, maxRows: 10 }}
                                            placeholder="生成的 HTML 代码将显示在这里..."
                                        />
                                        <Button type="primary" long style={{ marginTop: 16 }} onClick={handleCopy} disabled={!code}>
                                            <IconCopy /> 一键复制代码
                                        </Button>
                                    </Card>
                                </Col>
                                <Col xs={24} md={14}>
                                    <Card title="实时预览" bordered={false} style={{ height: '100%' }}>
                                        <div className="preview-container">
                                            {previewSrc ? (
                                                <iframe 
                                                    src={previewSrc} 
                                                    title="YouTube video player" 
                                                    frameBorder="0" 
                                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                                    referrerPolicy="strict-origin-when-cross-origin" 
                                                    allowFullScreen
                                                ></iframe>
                                            ) : (
                                                <div className="placeholder">
                                                    <IconVideoCamera style={{ fontSize: 48, marginBottom: 16 }} />
                                                    <p>请输入视频 ID 查看预览</p>
                                                </div>
                                            )}
                                        </div>
                                        <div style={{ marginTop: 16 }}>
                                            <Text type="secondary">
                                                注意：部分视频可能限制了嵌入播放。如果预览无法加载，请检查视频权限。
                                            </Text>
                                        </div>
                                    </Card>
                                </Col>
                            </Row>
                        </div>
                    </Content>
                </Layout>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
