<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office 在线预览助手 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue-icon.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-vue@latest/dist/arco.css">
    <style>
        body { background-color: #f2f3f5; margin: 0; }
        .iframe-container {
            width: 100%;
            height: calc(100vh - 160px);
            background: #fff;
            border: 1px solid #e5e6eb;
        }
    </style>
</head>
<body>
    <div id="app">
        <a-layout style="min-height: 100vh; display: flex; flex-direction: column;">
            <a-page-header
                style="background: #fff; border-bottom: 1px solid #e5e6eb;"
                title="Office 在线预览助手"
                subtitle="无需下载，直接预览 Word, Excel, PPT 文档"
                @back="goBack"
            ></a-page-header>
            <a-layout-content style="padding: 24px; flex: 1; display: flex; flex-direction: column;">
                <a-card :bordered="false" style="margin-bottom: 16px;">
                    <a-space size="large" style="width: 100%;">
                        <a-input 
                            style="width: 600px;" 
                            placeholder="请输入文档 URL (例如: http://example.com/file.docx)" 
                            v-model="url"
                            allow-clear
                            @press-enter="handlePreview"
                        >
                            <template #prefix><icon-file /></template>
                        </a-input>
                        <a-button type="primary" @click="handlePreview">
                            <template #icon><icon-eye /></template> 立即预览
                        </a-button>
                    </a-space>
                    <div style="margin-top: 12px;">
                        <a-alert type="info" show-icon>
                            注意：文档必须是公网可访问的 URL，不支持本地文件路径。
                        </a-alert>
                    </div>
                </a-card>

                <div class="iframe-container">
                    <iframe 
                        v-if="previewUrl"
                        :src="previewUrl" 
                        width="100%" 
                        height="100%" 
                        frameBorder="0"
                        title="Office Viewer"
                    ></iframe>
                    <div v-else style="display: flex; align-items: center; justify-content: center; height: 100%; color: #86909c; flex-direction: column;">
                        <icon-file style="font-size: 64px; margin-bottom: 16px; opacity: 0.5;" />
                        <span>请输入文档地址开始预览</span>
                    </div>
                </div>
            </a-layout-content>
        </a-layout>
    </div>

    <script>
        const { createApp } = Vue;
        const { Message } = ArcoVue;

        const App = {
            data() {
                return {
                    url: '',
                    previewUrl: ''
                };
            },
            methods: {
                goBack() {
                    window.location.href = 'index.html';
                },
                handlePreview() {
                    if (!this.url) {
                        Message.warning('请输入文档地址');
                        return;
                    }

                    // Simple extension validation
                    const validExtensions = ['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'];
                    const lowerUrl = this.url.toLowerCase();
                    const isValid = validExtensions.some(ext => lowerUrl.endsWith(ext));

                    if (!isValid) {
                        Message.warning('警告：该文件后缀可能不支持预览 (支持 .doc, .docx, .xls, .xlsx, .ppt, .pptx)');
                    }

                    const encodedUrl = encodeURIComponent(this.url);
                    this.previewUrl = `https://view.officeapps.live.com/op/view.aspx?src=${encodedUrl}`;
                    Message.loading({ content: '正在加载预览...', duration: 1000 });
                }
            }
        };

        const app = createApp(App);
        app.use(ArcoVue);
        app.use(ArcoVueIcon);
        app.mount('#app');
    </script>
</body>
</html>
