<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office 在线预览助手 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-react@latest/dist/css/arco.min.css">
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco-icon.min.js"></script>
    <style>
        body { background-color: #f2f3f5; margin: 0; }
        .iframe-container {
            width: 100%;
            height: calc(100vh - 160px);
            background: #fff;
            border: 1px solid #e5e6eb;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { Layout, Card, Input, Button, Message, PageHeader, Space, Typography, Alert } = arco;
        const { Content } = Layout;
        const { IconFile, IconEye } = arcoicon;

        function App() {
            const [url, setUrl] = React.useState('');
            const [previewUrl, setPreviewUrl] = React.useState('');

            const handlePreview = () => {
                if (!url) {
                    Message.warning('请输入文档地址');
                    return;
                }

                // Simple extension validation
                const validExtensions = ['.doc', '.docx', '.xls', '.xlsx', '.ppt', '.pptx'];
                const lowerUrl = url.toLowerCase();
                const isValid = validExtensions.some(ext => lowerUrl.endsWith(ext));

                if (!isValid) {
                    Message.warning('警告：该文件后缀可能不支持预览 (支持 .doc, .docx, .xls, .xlsx, .ppt, .pptx)');
                }

                const encodedUrl = encodeURIComponent(url);
                setPreviewUrl(`https://view.officeapps.live.com/op/view.aspx?src=${encodedUrl}`);
                Message.loading({ content: '正在加载预览...', duration: 1000 });
            };

            return (
                <Layout style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column' }}>
                    <PageHeader
                        style={{ background: '#fff', borderBottom: '1px solid #e5e6eb' }}
                        title="Office 在线预览助手"
                        subTitle="无需下载，直接预览 Word, Excel, PPT 文档"
                        backIcon
                        onBack={() => window.location.href = 'index.html'}
                    />
                    <Content style={{ padding: '24px', flex: 1, display: 'flex', flexDirection: 'column' }}>
                        <Card bordered={false} style={{ marginBottom: 16 }}>
                            <Space size="large" style={{ width: '100%' }}>
                                <Input 
                                    style={{ width: 600 }} 
                                    placeholder="请输入文档 URL (例如: http://example.com/file.docx)" 
                                    value={url}
                                    onChange={setUrl}
                                    prefix={<IconFile />}
                                    allowClear
                                    onPressEnter={handlePreview}
                                />
                                <Button type="primary" onClick={handlePreview}>
                                    <IconEye /> 立即预览
                                </Button>
                            </Space>
                            <div style={{ marginTop: 12 }}>
                                <Alert type="info" content="注意：文档必须是公网可访问的 URL，不支持本地文件路径。" showIcon />
                            </div>
                        </Card>

                        <div className="iframe-container">
                            {previewUrl ? (
                                <iframe 
                                    src={previewUrl} 
                                    width="100%" 
                                    height="100%" 
                                    frameBorder="0"
                                    title="Office Viewer"
                                ></iframe>
                            ) : (
                                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%', color: '#86909c', flexDirection: 'column' }}>
                                    <IconFile style={{ fontSize: 64, marginBottom: 16, opacity: 0.5 }} />
                                    <span>请输入文档地址开始预览</span>
                                </div>
                            )}
                        </div>
                    </Content>
                </Layout>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
