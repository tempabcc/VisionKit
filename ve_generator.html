<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VePlayer 嵌入生成器 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue-icon.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-vue@latest/dist/arco.css">
    <!-- VePlayer SDK for Preview -->
    <link rel="stylesheet" href="https://lf-unpkg.volccdn.com/obj/vcloudfe/sdk/@volcengine/veplayer/1.10.0/index.min.css" />
    <script src="https://lf-unpkg.volccdn.com/obj/vcloudfe/sdk/@volcengine/veplayer/1.10.0/index.min.js"></script>
    <style>
        body { background-color: #f2f3f5; }
        .preview-wrapper {
            width: 100%;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            position: relative;
            background: #000;
            border-radius: 4px;
            overflow: hidden;
        }
        #preview-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100% !important;
            height: 100% !important;
        }
        
        /* 移动端适配 */
        @media screen and (max-width: 768px) {
            .arco-layout-content {
                padding: 16px !important;
            }
            .arco-page-header {
                padding: 16px !important;
            }
            /* PageHeader 移动端终极适配 */
            .arco-page-header {
                padding: 12px 16px !important;
            }
            
            /* 强制 main 容器变为 flex 且换行 */
            .arco-page-header-header .arco-page-header-main {
                display: flex !important;
                flex-wrap: wrap !important;
                align-items: center !important;
                width: 100% !important;
            }
            
            /* 返回按钮：防压缩，定间距 */
            .arco-page-header-back-btn {
                margin-right: 8px !important;
                flex-shrink: 0 !important;
                display: inline-flex !important;
                color: var(--color-text-1);
            }
            
            /* 标题：占满剩余空间，单行省略 */
            .arco-page-header-title {
                flex: 1 1 auto !important;
                width: 0 !important;
                min-width: 0 !important;
                margin-right: 0 !important;
                margin-bottom: 0 !important;
                font-size: 16px !important;
                font-weight: 500;
                white-space: nowrap !important;
                overflow: hidden !important;
                text-overflow: ellipsis !important;
            }
            
            /* 隐藏分割线 */
            .arco-page-header-divider {
                display: none !important;
            }
            
            /* 副标题：独占一行，自动换行 */
            .arco-page-header-subtitle {
                display: block !important;
                width: 100% !important;
                margin-left: 0 !important;
                margin-top: 6px !important;
                font-size: 13px !important;
                color: var(--color-text-3);
                line-height: 1.5 !important;
                white-space: normal !important;
            }
            
            /* 移除 wrapper 可能的干扰 */
            .arco-page-header-wrapper {
                padding-left: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <a-layout style="min-height: 100vh;">
            <a-page-header
                style="background: #fff; border-bottom: 1px solid #e5e6eb;"
                title="VePlayer 嵌入生成器"
                subtitle="生成标准的 VePlayer 初始化代码"
                @back="goBack"
            ></a-page-header>
            <a-layout-content class="arco-layout-content" style="padding: 24px;">
                <div style="max-width: 1200px; margin: 0 auto;">
                    <a-row :gutter="[24, 24]">
                        <a-col :xs="24" :md="10">
                            <a-card title="配置参数" :bordered="false">
                                <a-form
                                    :model="form"
                                    layout="vertical"
                                >
                                    <a-form-item label="视频流地址 (URL)" field="url" :rules="[{ required: true }]">
                                        <a-input v-model="form.url" placeholder="mp4 / m3u8 地址" />
                                    </a-form-item>
                                    <a-form-item label="封面图 (Poster URL)" field="poster">
                                        <a-input v-model="form.poster" placeholder="可选" />
                                    </a-form-item>
                                    <a-row :gutter="16">
                                        <a-col :span="8">
                                            <a-form-item label="直播模式" field="isLive">
                                                <a-switch v-model="form.isLive" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="8">
                                            <a-form-item label="自动播放" field="autoplay">
                                                <a-switch v-model="form.autoplay" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="8">
                                            <a-form-item label="显示控制栏" field="controls">
                                                <a-switch v-model="form.controls" />
                                            </a-form-item>
                                        </a-col>
                                    </a-row>
                                    <a-button type="primary" long @click="handleGenerate">
                                        <template #icon><icon-refresh /></template>
                                        生成代码并预览
                                    </a-button>
                                </a-form>
                            </a-card>

                            <a-card title="嵌入代码" :bordered="false" style="margin-top: 24px;">
                                <a-textarea 
                                    v-model="code" 
                                    :auto-size="{ minRows: 6, maxRows: 12 }"
                                    placeholder="点击生成按钮获取代码..."
                                />
                                <a-button type="secondary" long style="margin-top: 16px;" @click="handleCopy" :disabled="!code">
                                    <template #icon><icon-copy /></template> 一键复制
                                </a-button>
                            </a-card>
                        </a-col>
                        <a-col :xs="24" :md="14">
                            <a-card title="效果预览" :bordered="false" style="height: 100%;">
                                <div class="preview-wrapper">
                                    <div id="preview-player"></div>
                                </div>
                            </a-card>
                        </a-col>
                    </a-row>
                </div>
            </a-layout-content>
        </a-layout>
    </div>

    <script>
        const { createApp } = Vue;
        const { Message } = ArcoVue;

        const App = {
            data() {
                return {
                    form: {
                        url: 'https://lf9-cdn-tos.bytecdntp.com/cdn/expire-1-M/byted-player-videos/1.0.0/xgplayer-demo.mp4',
                        poster: '',
                        isLive: false,
                        autoplay: false,
                        controls: true
                    },
                    code: '',
                    playerInstance: null
                };
            },
            methods: {
                goBack() {
                    window.location.href = 'index.html';
                },
                handleGenerate() {
                    if (!this.form.url) {
                        Message.error('请输入视频地址');
                        return;
                    }

                    const values = this.form;

                    // Generate Code
                    const scriptCode = `
<!-- 引入 VePlayer -->
<link rel="stylesheet" href="https://lf-unpkg.volccdn.com/obj/vcloudfe/sdk/@volcengine/veplayer/1.10.0/index.min.css" />
<script src="https://lf-unpkg.volccdn.com/obj/vcloudfe/sdk/@volcengine/veplayer/1.10.0/index.min.js"><\/script>

<!-- 播放器容器 (16:9 比例) -->
<div id="veplayer" style="width: 100%; max-width: 800px; aspect-ratio: 16/9;"></div>

<script>
    const player = new VePlayer({
        id: 'veplayer',
        width: '100%',
        height: '100%',
        url: '${values.url}',
        poster: '${values.poster || ''}',
        isLive: ${values.isLive},
        autoplay: ${values.autoplay},
        controls: ${values.controls},
        vodLogOpts: {
            line_app_id: 1, // 00000001
            tag: '普通视频'
        }
    });
<\/script>
                    `.trim();
                    
                    this.code = scriptCode;

                    // Update Preview
                    if (this.playerInstance) {
                        this.playerInstance.destroy();
                    }

                    try {
                        this.playerInstance = new VePlayer({
                            id: 'preview-player',
                            width: '100%',
                            height: '100%',
                            url: values.url,
                            poster: values.poster,
                            isLive: values.isLive,
                            autoplay: values.autoplay,
                            controls: values.controls,
                            vodLogOpts: {
                                line_app_id: 1, // 00000001
                                tag: '普通视频'
                            }
                        });
                        Message.success('预览已更新');
                    } catch (e) {
                        console.error(e);
                        Message.error('预览初始化失败');
                    }
                },
                handleCopy() {
                    if (!this.code) return;
                    navigator.clipboard.writeText(this.code).then(() => {
                        Message.success('代码已复制');
                    }).catch(() => {
                        Message.error('复制失败');
                    });
                }
            }
        };

        const app = createApp(App);
        app.use(ArcoVue);
        app.use(ArcoVueIcon);
        app.mount('#app');
    </script>
</body>
</html>
