<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通用 Iframe 生成器 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-vue@latest/dist/arco-vue-icon.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-vue@latest/dist/arco.css">
    <style>
        body { background-color: #f2f3f5; }
        .preview-container {
            background: #fff;
            width: 100%;
            min-height: 400px;
            /* display: flex;  Removed to prevent overflow clipping */
            /* align-items: center; */
            /* justify-content: center; */
            border: 1px dashed #c9cdd4;
            border-radius: 4px;
            overflow: auto;
            padding: 20px;
            background-image: radial-gradient(#e5e6eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <a-layout style="min-height: 100vh;">
            <a-page-header
                style="background: #fff; border-bottom: 1px solid #e5e6eb;"
                title="通用 Iframe 生成器"
                subtitle="生成高度可定制的 Iframe 嵌入代码"
                @back="goBack"
            ></a-page-header>
            <a-layout-content style="padding: 24px;">
                <div style="max-width: 1200px; margin: 0 auto;">
                    <a-alert type="info" title="操作指引" style="margin-bottom: 24px;">
                        1. 输入需要嵌入的目标网页地址 (URL)。<br/>
                        2. 调整宽度、高度和其他显示选项。<br/>
                        3. 点击“生成代码”按钮预览效果并获取代码。<br/>
                        注意：生成的 Iframe 能否正常显示取决于目标网站的安全策略 (CSP/X-Frame-Options)。
                    </a-alert>

                    <a-row :gutter="[24, 24]">
                        <!-- Configuration Panel -->
                        <a-col :xs="24" :md="10">
                            <a-card title="配置参数" :bordered="false">
                                <a-form
                                    :model="form"
                                    layout="vertical"
                                >
                                    <a-form-item label="源地址 (URL)" field="src" :rules="[{ required: true }]">
                                        <a-input v-model="form.src" placeholder="https://example.com/page 或 video.mp4" @blur="handleSrcBlur" />
                                        <div v-if="isVideoUrl" style="margin-top: 8px; font-size: 12px; color: #165dff;">
                                            <icon-video-camera /> 检测到视频链接，将自动使用内置播放器生成嵌入代码。
                                        </div>
                                    </a-form-item>

                                    <a-row :gutter="16">
                                        <a-col :span="14">
                                            <a-form-item label="宽度" field="width">
                                                <a-input-number v-model="form.width" :min="0" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="10">
                                            <a-form-item label="单位" field="widthType">
                                                <a-select v-model="form.widthType" :options="['px', '%']" />
                                            </a-form-item>
                                        </a-col>
                                    </a-row>

                                    <a-row :gutter="16">
                                        <a-col :span="14">
                                            <a-form-item label="高度" field="height">
                                                <a-input-number v-model="form.height" :min="0" />
                                            </a-form-item>
                                        </a-col>
                                        <a-col :span="10">
                                            <a-form-item label="单位" field="heightType">
                                                <a-select v-model="form.heightType" :options="['px', '%']" />
                                            </a-form-item>
                                        </a-col>
                                    </a-row>

                                    <a-collapse :default-active-key="['1']" style="margin-bottom: 24px;">
                                        <a-collapse-item header="高级选项" key="1">
                                            <a-row :gutter="16">
                                                <a-col :span="12">
                                                    <a-form-item label="显示边框" field="border">
                                                        <a-switch v-model="form.border" />
                                                    </a-form-item>
                                                </a-col>
                                                <a-col :span="12">
                                                    <a-form-item field="allowFullscreen">
                                                        <template #label>
                                                            <a-space>
                                                                允许全屏
                                                                <a-tooltip content="包含 webkit/moz/ms 前缀以支持旧版浏览器">
                                                                    <icon-info-circle />
                                                                </a-tooltip>
                                                            </a-space>
                                                        </template>
                                                        <a-switch v-model="form.allowFullscreen" />
                                                    </a-form-item>
                                                </a-col>
                                                <a-col :span="12">
                                                    <a-form-item label="允许滚动条" field="scrolling">
                                                        <a-switch v-model="form.scrolling" />
                                                    </a-form-item>
                                                </a-col>
                                                <a-col :span="12">
                                                    <a-form-item label="字体大小 (pt)" field="fontSize">
                                                        <a-input-number v-model="form.fontSize" :min="8" :max="72" />
                                                    </a-form-item>
                                                </a-col>
                                                <a-col :span="24">
                                                    <a-form-item field="sandbox">
                                                        <template #label>
                                                            <a-space>
                                                                启用沙箱 (Sandbox)
                                                                <a-tooltip content="增加安全性，但可能限制部分功能">
                                                                    <icon-info-circle />
                                                                </a-tooltip>
                                                            </a-space>
                                                        </template>
                                                        <a-switch v-model="form.sandbox" />
                                                    </a-form-item>
                                                </a-col>
                                            </a-row>
                                        </a-collapse-item>
                                    </a-collapse>

                                    <a-button type="primary" long @click="generateCode">
                                        <template #icon><icon-code /></template>
                                        生成代码
                                    </a-button>
                                </a-form>
                            </a-card>
                        </a-col>

                        <!-- Preview & Output Panel -->
                        <a-col :xs="24" :md="14">
                            <a-space direction="vertical" size="large" style="width: 100%;">
                                <a-card title="生成的代码" :bordered="false">
                                    <a-textarea 
                                        v-model="code" 
                                        :auto-size="{ minRows: 4, maxRows: 8 }"
                                        placeholder="点击左侧生成按钮，或直接粘贴 Iframe 代码..."
                                        style="font-family: monospace; font-size: 13px; color: #0057b7;"
                                    ></a-textarea>
                                    <div style="margin-top: 12px; display: flex; justify-content: flex-end; gap: 8px;">
                                        <a-button type="primary" status="success" @click="handlePreviewFromCode" :disabled="!code">
                                            <template #icon><icon-play-circle /></template> 预览代码
                                        </a-button>
                                        <a-button type="secondary" @click="handleCopy" :disabled="!code">
                                            <template #icon><icon-copy /></template> 复制到剪贴板
                                        </a-button>
                                    </div>
                                </a-card>

                                <a-card title="效果预览" :bordered="false">
                                    <div id="preview-box" class="preview-container">
                                        <div v-if="!previewConfig" style="text-align: center; color: #86909c;">
                                            <icon-code style="font-size: 48px; margin-bottom: 16px;" />
                                            <p>生成后在此处查看预览</p>
                                        </div>
                                    </div>
                                    <div v-if="previewConfig" style="margin-top: 12px; font-size: 12px; color: #86909c;">
                                        <icon-info-circle /> 注意：部分网站（如 Google, GitHub）设置了 X-Frame-Options 响应头，禁止被嵌入 Iframe 中。
                                    </div>
                                </a-card>
                            </a-space>
                        </a-col>
                    </a-row>
                </div>
            </a-layout-content>
        </a-layout>
    </div>

    <script>
        const { createApp } = Vue;
        const { Message } = ArcoVue;

        const App = {
            data() {
                return {
                    form: {
                        src: 'https://www.bing.com',
                        width: 600,
                        widthType: 'px',
                        height: 338,
                        heightType: 'px',
                        border: false,
                        scrolling: true,
                        allowFullscreen: true,
                        sandbox: false,
                        fontSize: 12
                    },
                    code: '',
                    previewConfig: null,
                    isVideoUrl: false
                };
            },
            methods: {
                goBack() {
                    window.location.href = 'index.html';
                },
                handleSrcBlur() {
                    const url = this.form.src.toLowerCase();
                    this.isVideoUrl = url.endsWith('.mp4') || 
                                    url.endsWith('.m3u8') || 
                                    url.endsWith('.webm') || 
                                    url.endsWith('.ogv');
                },
                generateCode() {
                    if (!this.form.src) {
                        Message.warning('请输入嵌入地址 (URL)');
                        return;
                    }

                    const values = this.form;
                    
                    // Construct attributes
                    const attrs = [];
                    
                    // Check if video mode
                    let finalSrc = values.src;
                    if (this.isVideoUrl) {
                        // Get current base URL path to locate simple_player.html
                        // Assuming simple_player.html is in the same directory
                        const playerPath = 'simple_player.html'; 
                        finalSrc = `${playerPath}?src=${encodeURIComponent(values.src)}`;
                    }
                    
                    attrs.push(`src="${finalSrc}"`);
                    
                    // Dimensions
                    const w = values.widthType === 'px' ? values.width : `${values.width}%`;
                    const h = values.heightType === 'px' ? values.height : `${values.height}%`;
                    attrs.push(`width="${w}"`);
                    attrs.push(`height="${h}"`);

                    // Borders & Scroll
                    attrs.push(`frameborder="${values.border ? 1 : 0}"`);
                    if (values.scrolling === false) attrs.push(`scrolling="no"`);
                    
                    // Fullscreen support
                    if (values.allowFullscreen) {
                        attrs.push('allowfullscreen');
                        attrs.push('webkitallowfullscreen');
                        attrs.push('mozallowfullscreen');
                        attrs.push('oallowfullscreen');
                        attrs.push('msallowfullscreen');
                    }

                    // Sandbox
                    if (values.sandbox) {
                        attrs.push('sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-presentation"');
                    }

                    // Styles
                    const styles = [];
                    if (!values.border) styles.push('border: 0');
                    if (values.fontSize) styles.push(`font-size: ${values.fontSize}pt`);
                    if (styles.length > 0) {
                        attrs.push(`style="${styles.join('; ')}"`);
                    }

                    const iframeCode = `<iframe ${attrs.join(' ')}></iframe>`;
                    this.code = iframeCode;
                    this.previewConfig = { ...values, html: iframeCode };
                    
                    this.updatePreviewDOM(iframeCode);
                    
                    Message.success('代码已生成');
                },
                handlePreviewFromCode() {
                    if (!this.code) return;
                    
                    // 简单的校验，只要包含 <iframe 即可
                    if (!this.code.toLowerCase().includes('<iframe')) {
                        Message.warning('代码必须包含 <iframe> 标签');
                        return;
                    }

                    this.previewConfig = { html: this.code };
                    this.updatePreviewDOM(this.code);
                    Message.success('预览已更新');
                },
                updatePreviewDOM(html) {
                    this.$nextTick(() => {
                        const container = document.getElementById('preview-box');
                        if (container) {
                            container.innerHTML = ''; // 清空
                            setTimeout(() => {
                                container.innerHTML = html; // 写入
                            }, 10);
                        }
                    });
                },
                handleCopy() {
                    if (!this.code) return;
                    navigator.clipboard.writeText(this.code).then(() => {
                        Message.success('代码已复制');
                    });
                }
            }
        };

        const app = createApp(App);
        app.use(ArcoVue);
        app.use(ArcoVueIcon);
        app.mount('#app');
    </script>
</body>
</html>
