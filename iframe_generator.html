<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>通用 Iframe 生成器 - VisionKit</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/@arco-design/web-react@latest/dist/css/arco.min.css">
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco.min.js"></script>
    <script src="https://unpkg.com/@arco-design/web-react@latest/dist/arco-icon.min.js"></script>
    <style>
        body { background-color: #f2f3f5; }
        .preview-container {
            background: #fff;
            width: 100%;
            min-height: 400px;
            /* display: flex;  Removed to prevent overflow clipping */
            /* align-items: center; */
            /* justify-content: center; */
            border: 1px dashed #c9cdd4;
            border-radius: 4px;
            overflow: auto;
            padding: 20px;
            background-image: radial-gradient(#e5e6eb 1px, transparent 1px);
            background-size: 20px 20px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { Layout, Card, Form, Input, InputNumber, Switch, Button, Grid, Typography, Message, PageHeader, Space, Tooltip, Collapse, Select } = arco;
        const { Content } = Layout;
        const { Title, Text } = Typography;
        const { Row, Col } = Grid;
        const { IconCopy, IconCode, IconRefresh, IconInfoCircle } = arcoicon;

        function App() {
            const [form] = Form.useForm();
            const [code, setCode] = React.useState('');
            const [previewConfig, setPreviewConfig] = React.useState(null);

            const generateCode = () => {
                const values = form.getFieldsValue();
                if (!values.src) {
                    Message.warning('请输入嵌入地址 (URL)');
                    return;
                }

                // Construct attributes
                const attrs = [];
                attrs.push(`src="${values.src}"`);
                
                // Dimensions
                const w = values.widthType === 'px' ? values.width : `${values.width}%`;
                const h = values.heightType === 'px' ? values.height : `${values.height}%`;
                attrs.push(`width="${w}"`);
                attrs.push(`height="${h}"`);

                // Borders & Scroll
                attrs.push(`frameborder="${values.border ? 1 : 0}"`);
                if (values.scrolling === false) attrs.push(`scrolling="no"`);
                
                // Fullscreen support
                if (values.allowFullscreen) {
                    attrs.push('allowfullscreen');
                    // Legacy attributes for older browsers
                    attrs.push('webkitallowfullscreen');
                    attrs.push('mozallowfullscreen');
                    attrs.push('oallowfullscreen');
                    attrs.push('msallowfullscreen');
                }

                // Sandbox
                if (values.sandbox) {
                    attrs.push('sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-presentation"');
                }

                // Styles
                const styles = [];
                if (!values.border) styles.push('border: 0');
                if (values.fontSize) styles.push(`font-size: ${values.fontSize}pt`);
                if (styles.length > 0) {
                    attrs.push(`style="${styles.join('; ')}"`);
                }

                const iframeCode = `<iframe ${attrs.join(' ')}></iframe>`;
                setCode(iframeCode);
                setPreviewConfig({ ...values, html: iframeCode });
                Message.success('代码已生成');
            };

            const handleCopy = () => {
                if (!code) return;
                navigator.clipboard.writeText(code).then(() => {
                    Message.success('代码已复制');
                });
            };

            return (
                <Layout style={{ minHeight: '100vh' }}>
                    <PageHeader
                        style={{ background: '#fff', borderBottom: '1px solid #e5e6eb' }}
                        title="通用 Iframe 生成器"
                        subTitle="生成高度可定制的 Iframe 嵌入代码"
                        backIcon
                        onBack={() => window.location.href = 'index.html'}
                    />
                    <Content style={{ padding: '24px' }}>
                        <div style={{ maxWidth: 1200, margin: '0 auto' }}>
                            <Row gutter={[24, 24]}>
                                {/* Configuration Panel */}
                                <Col xs={24} md={10}>
                                    <Card title="配置参数" bordered={false}>
                                        <Form
                                            form={form}
                                            layout="vertical"
                                            initialValues={{
                                                src: 'https://www.bing.com',
                                                width: 600,
                                                widthType: 'px',
                                                height: 338,
                                                heightType: 'px',
                                                border: false,
                                                scrolling: true,
                                                allowFullscreen: true,
                                                sandbox: false,
                                                fontSize: 12
                                            }}
                                        >
                                            <Form.Item label="源地址 (URL)" field="src" rules={[{ required: true }]}>
                                                <Input placeholder="https://example.com" />
                                            </Form.Item>

                                            <Row gutter={16}>
                                                <Col span={14}>
                                                    <Form.Item label="宽度" field="width">
                                                        <InputNumber min={0} />
                                                    </Form.Item>
                                                </Col>
                                                <Col span={10}>
                                                    <Form.Item label="单位" field="widthType">
                                                        <Select options={['px', '%']} />
                                                    </Form.Item>
                                                </Col>
                                            </Row>

                                            <Row gutter={16}>
                                                <Col span={14}>
                                                    <Form.Item label="高度" field="height">
                                                        <InputNumber min={0} />
                                                    </Form.Item>
                                                </Col>
                                                <Col span={10}>
                                                    <Form.Item label="单位" field="heightType">
                                                        <Select options={['px', '%']} />
                                                    </Form.Item>
                                                </Col>
                                            </Row>

                                            <Collapse defaultActiveKey={['1']} style={{ marginBottom: 24 }}>
                                                <Collapse.Item header="高级选项" name="1">
                                                    <Row gutter={16}>
                                                        <Col span={12}>
                                                            <Form.Item label="显示边框" field="border" triggerPropName="checked">
                                                                <Switch />
                                                            </Form.Item>
                                                        </Col>
                                                        <Col span={12}>
                                                            <Form.Item 
                                                                label={
                                                                    <Space>
                                                                        允许全屏
                                                                        <Tooltip content="包含 webkit/moz/ms 前缀以支持旧版浏览器">
                                                                            <IconInfoCircle />
                                                                        </Tooltip>
                                                                    </Space>
                                                                } 
                                                                field="allowFullscreen" 
                                                                triggerPropName="checked"
                                                            >
                                                                <Switch />
                                                            </Form.Item>
                                                        </Col>
                                                        <Col span={12}>
                                                            <Form.Item label="允许滚动条" field="scrolling" triggerPropName="checked">
                                                                <Switch />
                                                            </Form.Item>
                                                        </Col>
                                                        <Col span={12}>
                                                            <Form.Item label="字体大小 (pt)" field="fontSize">
                                                                <InputNumber min={8} max={72} />
                                                            </Form.Item>
                                                        </Col>
                                                        <Col span={24}>
                                                            <Form.Item 
                                                                label={
                                                                    <Space>
                                                                        启用沙箱 (Sandbox)
                                                                        <Tooltip content="增加安全性，但可能限制部分功能">
                                                                            <IconInfoCircle />
                                                                        </Tooltip>
                                                                    </Space>
                                                                } 
                                                                field="sandbox" 
                                                                triggerPropName="checked"
                                                            >
                                                                <Switch />
                                                            </Form.Item>
                                                        </Col>
                                                    </Row>
                                                </Collapse.Item>
                                            </Collapse>

                                            <Button type="primary" long onClick={generateCode} icon={<IconCode />}>
                                                生成代码
                                            </Button>
                                        </Form>
                                    </Card>
                                </Col>

                                {/* Preview & Output Panel */}
                                <Col xs={24} md={14}>
                                    <Space direction="vertical" size="large" style={{ width: '100%' }}>
                                        <Card title="生成的代码" bordered={false}>
                                            <Input.TextArea 
                                                value={code} 
                                                autoSize={{ minRows: 4, maxRows: 8 }}
                                                placeholder="点击左侧生成按钮..."
                                                style={{ fontFamily: 'monospace', fontSize: 13, color: '#0057b7' }}
                                            />
                                            <div style={{ marginTop: 12, textAlign: 'right' }}>
                                                <Button type="secondary" onClick={handleCopy} disabled={!code}>
                                                    <IconCopy /> 复制到剪贴板
                                                </Button>
                                            </div>
                                        </Card>

                                        <Card title="效果预览" bordered={false}>
                                            <div className="preview-container">
                                                {previewConfig ? (
                                                    <div dangerouslySetInnerHTML={{ __html: previewConfig.html }} />
                                                ) : (
                                                    <div style={{ textAlign: 'center', color: '#86909c' }}>
                                                        <IconCode style={{ fontSize: 48, marginBottom: 16 }} />
                                                        <p>生成后在此处查看预览</p>
                                                    </div>
                                                )}
                                            </div>
                                            {previewConfig && (
                                                <div style={{ marginTop: 12, fontSize: 12, color: '#86909c' }}>
                                                    <IconInfoCircle /> 注意：部分网站（如 Google, GitHub）设置了 X-Frame-Options 响应头，禁止被嵌入 Iframe 中。
                                                </div>
                                            )}
                                        </Card>
                                    </Space>
                                </Col>
                            </Row>
                        </div>
                    </Content>
                </Layout>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
